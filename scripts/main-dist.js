import*as THREE from"../node_modules/three/build/three.module.js";import*as GLTFLoader from"../node_modules/three/examples/jsm/loaders/GLTFLoader.js";import*as CONTROLS from"../node_modules/three/examples/jsm/controls/OrbitControls.js";!function(){const e="78ac5fdc69419cf96f7db810885b1301",t="https://api.openweathermap.org/data/2.5/",n="http://api.openweathermap.org/geo/1.0/",o={sun:{icon:"assets/icons/sun.png",bgi:"assets/sun-bg.png"},rain:{icon:"assets/icons/rain.png",bgi:"assets/rain-bg.png"},cloud:{icon:"assets/icons/cloud.png",bgi:"assets/cloud-bg.png"},snow:{icon:"assets/icons/snow.png",bgi:"assets/snow-bg.png"},storm:{icon:"assets/icons/storm.png",bgi:"assets/storm-bg.png"}},i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=document.querySelector(".search-box"),r=document.querySelectorAll(".day");var s="sun",d=null,c=null,l=document.querySelector(".selected-day"),u=document.querySelector(".temperature").children[0];function m(t){var o;13!==t.keyCode&&0!==t.button||(document.querySelector(".location-name").innerHTML=a.value,o=a.value,fetch(`${n}direct?q=${o}&APPID=${e}`).then(e=>e.json()).then(p))}function p(n){let o=n;0!=o.length?function(n,o){fetch(`${t}onecall?lat=${n}&lon=${o}&units=metric&exclude=minutely,hourly,alerts&APPID=${e}`).then(e=>e.json()).then(g)}(o[0].lat,o[0].lon):a.classList.add("errorInput")}function h(){let e=this,t=e.getAttribute("weekday");l.innerHTML=t;let n=e.getAttribute("temp")+"°C";u.innerHTML=n,s=e.getAttribute("weather");var i=o[s];c.style.backgroundImage="url('"+i.bgi+"')";for(var a=0;a<r.length;a++)r[a].classList.remove("active");e.classList.add("active"),b.setModel()}function g(e){c=document.querySelector(".main-bg");let t=document.querySelectorAll(".day");document.querySelector(".landing-page").classList.add("hide"),document.querySelector(".weather-search").classList.add("show"),u.innerHTML=e.daily[0].temp.day+"°C";for(let n=0;n<7;n++){let a=t[n],r=e.daily[n],s=1e3*r.dt,d=new Date(s),c=(d.toLocaleString(),i[d.getDay()]);a.setAttribute("weekday",c);let u=r.weather[0].main;switch(0==n&&(l.innerHTML=c),a.childNodes[3].innerText=r.temp.day+"°C",a.setAttribute("temp",r.temp.day),u){case"Clear":w(a,"sun",o.sun,n);break;case"Clouds":w(a,"cloud",o.cloud,n);case"Drizzle":case"Rain":w(a,"rain",o.rain,n);break;case"Thunderstorm":w(a,"storm",o.storm,n);break;case"Snow":w(a,"snow",o.snow,n);break;default:w(a,"sun",o.sun,n)}}b.init()}function w(e,t,n,o){e.setAttribute("weather",t),e.children[0].setAttribute("src",n.icon),c.style.backgroundImage="url('"+n.bgi+"')",0==o&&(s=t)}!function(){a.addEventListener("keypress",m),document.querySelector(".search-icon").addEventListener("click",m);for(var e=0;e<r.length;e++)r[e].addEventListener("click",h)}();var b=function(){var e=null,t=null,n=null,o=null,i=null;function a(){e.load("assets/models/"+s+".gltf",(function(e){e.name=s,n.remove(d),d=e.scene,n.add(e.scene),c()}),(function(e){console.log(e.loaded/e.total*100+"% loaded")}),(function(e){console.log("An error happened"+e)}))}function r(){requestAnimationFrame(r),o.update(),t.render(n,i)}function c(){window.innerWidth<768?d.scale.set(1.7,1.7,1.7):d.scale.set(2.5,2.5,2.5)}return{init:function(){e=new GLTFLoader.GLTFLoader;var s=[];!function e(){requestAnimationFrame(e),s.forEach(e=>{e()})}(),n=new THREE.Scene,(i=new THREE.PerspectiveCamera(100,window.innerWidth/window.innerHeight,.1,800)).position.set(1,1,8),(t=new THREE.WebGLRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),t.setSize(window.innerWidth,window.innerHeight),t.setClearColor(0,0),t.toneMapping=THREE.LinearToneMapping,t.toneMappingExposure=Math.pow(.94,5),t.shadowMap.enabled=!0,t.shadowMap.type=THREE.PCFShadowMap,window.addEventListener("resize",(function(){i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),c(),t.setSize(window.innerWidth,window.innerHeight)}),!1),document.querySelector(".weather-object").appendChild(t.domElement),s.push((function(){t.render(n,i)})),function(){const e=new THREE.DirectionalLight(4210752,4.5);e.position.set(0,0,25),n.add(e);const t=new THREE.DirectionalLight(4210752,4.5);t.position.set(0,25,-25),n.add(t);const o=new THREE.DirectionalLight(4210752,1);o.position.set(0,-25,0),n.add(o)}(),(o=new CONTROLS.OrbitControls(i,t.domElement)).autoRotate=!0,o.autoRotateSpeed=1,o.target=new THREE.Vector3(.5,.5,.5),o.enableZoom=!1,a(),r()},setModel:a}}()}();